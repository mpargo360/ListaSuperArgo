<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lista de Compras</title>
<style>
:root {
  --bg: #f5f5f7;
  --text: #222;
  --accent: #0078d7;
  --card: #fff;
  --muted: #777;
}
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
}
.app {
  max-width: 500px;
  margin: 40px auto;
  padding: 40px 20px; /* m√°s margen arriba/abajo */
}
h1 {
  text-align: center;
  margin-bottom: 1.5em;
}
button {
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 8px 14px;
  cursor: pointer;
  font-weight: 600;
}
button.small {
  padding: 4px 8px;
  font-size: 0.9em;
}
button:active { opacity: 0.8; }
.category {
  background: var(--card);
  border-radius: 16px;
  margin-bottom: 1.5em; /* m√°s separaci√≥n entre categor√≠as */
  padding: 15px 18px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.category h2 {
  margin: 0 0 10px 0;
  font-size: 1.2em;
  text-transform: capitalize;
}
.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
  border-bottom: 1px solid #eee;
}
.item:last-child { border-bottom: none; }
.item .left {
  display: flex;
  align-items: center;
  gap: 10px;
}
.buy {
  min-width: 32px;
  text-align: center;
  font-weight: 700;
  background: var(--accent);
  color: #fff;
  border-radius: 8px;
  padding: 2px 6px;
  font-size: 0.9rem;
}
.name {
  font-weight: 500;
}
.small.muted {
  font-size: 0.8em;
  color: var(--muted);
  margin-top: 2px;
}
.controls {
  display: flex;
  align-items: center;
  gap: 6px;
}
.qty {
  font-weight: 600;
  width: 20px;
  text-align: center;
}
.trash { cursor: pointer; color: crimson; }
footer {
  text-align: center;
  margin-top: 2em;
}
.hidden { display: none !important; }
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal-content {
  background: var(--card);
  padding: 20px;
  border-radius: 14px;
  width: 90%;
  max-width: 350px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  gap: 10px;
}
input, select {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  width: 100%;
  box-sizing: border-box;
}
.theme-toggle {
  position: absolute;
  right: 15px;
  top: 15px;
  background: none;
  color: var(--accent);
  font-size: 1.3em;
}
</style>
</head>
<body>
<div class="app">
  <button id="themeToggle" class="theme-toggle" title="Cambiar tema">üåô</button>
  <h1>üõí Lista de Compras</h1>
  <div id="list"></div>
  <footer>
    <button id="addBtn">Agregar producto</button>
    <button id="editBtn">üìù Editar</button>
    <button id="exportBtn">üìã Copiar datos</button>
  </footer>
</div>

<!-- Modal -->
<div class="modal hidden" id="modal">
  <div class="modal-content">
    <h3>Nuevo producto</h3>
    <input type="text" id="nameInput" placeholder="Nombre del producto">
    <select id="categorySelect">
      <option value="">Eleg√≠ categor√≠a...</option>
      <option>Almac√©n</option>
      <option>L√°cteos</option>
      <option>Verduler√≠a</option>
      <option>Bebidas</option>
      <option>Otros</option>
    </select>
    <button id="saveBtn">Guardar</button>
    <button id="cancelBtn" style="background:#aaa;">Cancelar</button>
  </div>
</div>

<script>
const STORAGE_KEY = "shoppingList_v3";
const THEME_KEY = "theme";
let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
  { cat: "Almac√©n", items: [ {name:"Arroz", have:1, ideal:3}, {name:"Fideos", have:0, ideal:2} ] },
  { cat: "L√°cteos", items: [ {name:"Leche", have:1, ideal:2} ] }
];
let editMode = false;

function escapeHtml(str) {
  return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}
function render() {
  const list = document.getElementById("list");
  list.innerHTML = "";
  data.forEach((cat, i) => {
    const catDiv = document.createElement("div");
    catDiv.className = "category";
    catDiv.innerHTML = `<h2>${escapeHtml(cat.cat)}</h2>`;
    cat.items.forEach((item, j) => {
      const buy = Math.max(0, item.ideal - item.have);
      const itemDiv = document.createElement("div");
      itemDiv.className = "item";
      const globalIndex = `${i},${j}`;
      itemDiv.innerHTML = `
        <div class="left">
          <div>üõí</div>
          <div class="buy">${buy > 0 ? buy : '‚úîÔ∏è'}</div>
          <div style="display:flex;flex-direction:column">
            <div class="name" ${editMode ? `contenteditable="true" data-field="name" data-idx="${globalIndex}"` : ''}>
              ${escapeHtml(item.name)}
            </div>
            <div class="small muted ${editMode ? '' : 'hidden'}">Ideal: 
              <span ${editMode ? `contenteditable="true" data-field="ideal" data-idx="${globalIndex}"` : ''}>
                ${escapeHtml(String(item.ideal))}
              </span>
            </div>
          </div>
        </div>
        <div class="controls">
          <button class="small" onclick="decrement(${i},${j})">‚àí</button>
          <div class="qty">${item.have}</div>
          <button class="small" onclick="increment(${i},${j})">+</button>
          ${editMode ? `<div class="trash" onclick="removeItem(${i},${j})">‚úñ</div>` : ''}
        </div>`;
      catDiv.appendChild(itemDiv);
    });
    list.appendChild(catDiv);
  });
  save();
}

function increment(i,j){ data[i].items[j].have++; render(); }
function decrement(i,j){ if(data[i].items[j].have>0) data[i].items[j].have--; render(); }
function removeItem(i,j){ data[i].items.splice(j,1); render(); }
function toggleEdit(){ editMode=!editMode; render(); }

document.getElementById("editBtn").onclick = toggleEdit;
document.addEventListener("input", e=>{
  const field = e.target.dataset.field;
  const idx = e.target.dataset.idx;
  if(!field || !idx) return;
  const [i,j] = idx.split(",").map(Number);
  if(field==="name") data[i].items[j].name = e.target.textContent.trim();
  if(field==="ideal") data[i].items[j].ideal = parseInt(e.target.textContent) || 0;
  save();
});

const modal = document.getElementById("modal");
document.getElementById("addBtn").onclick = ()=> modal.classList.remove("hidden");
document.getElementById("cancelBtn").onclick = ()=> modal.classList.add("hidden");
document.getElementById("saveBtn").onclick = ()=>{
  const name = document.getElementById("nameInput").value.trim();
  const cat = document.getElementById("categorySelect").value.trim();
  if(!name || !cat) return alert("Complet√° todos los campos");
  let c = data.find(c=>c.cat===cat);
  if(!c){ c={cat,items:[]}; data.push(c); }
  c.items.push({name,have:0,ideal:1});
  modal.classList.add("hidden");
  document.getElementById("nameInput").value="";
  render();
};

const themeBtn = document.getElementById("themeToggle");
themeBtn.onclick = ()=>{
  const isLight = document.body.dataset.theme!=="dark";
  document.body.dataset.theme = isLight ? "dark" : "light";
  localStorage.setItem(THEME_KEY, isLight?"dark":"light");
  themeBtn.textContent = isLight?"‚òÄÔ∏è":"üåô";
};
(function(){
  const saved = localStorage.getItem(THEME_KEY);
  if(saved==="dark"){
    document.body.dataset.theme="dark";
    themeBtn.textContent="‚òÄÔ∏è";
    document.documentElement.style.setProperty('--bg','#1e1e1e');
    document.documentElement.style.setProperty('--text','#f5f5f5');
    document.documentElement.style.setProperty('--card','#2a2a2a');
  }
})();
document.getElementById("exportBtn").onclick = ()=>{
  navigator.clipboard.writeText(JSON.stringify(data,null,2));
  alert("üìã Copiado al portapapeles");
};
render();
</script>
</body>
</html>
